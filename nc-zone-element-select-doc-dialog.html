<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../neon-animation/web-animations.html">
<link rel="import" href="../neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<link rel="import" href="nc-zone-behavior.html">

<dom-module id="nc-zone-element-select-doc-dialog">
  <template>
    <style>
      .doc{}
    </style>

    <paper-dialog id="selectDocDialog" class="modalNoApp" modal entry-animation="scale-up-animation">
      <div class="header">
        <iron-icon icon="content-copy"></iron-icon><h3>{{localize('ELEMENT_SELECT_DOC_DIALOG_TITLE')}}</h3>
      </div>
      <!-- <div class="content">
        <p>{{localize('ELEMENT_SELECT_DOC_DIALOG_SUBTITLE')}} <b>[[elementConf.id]]</b></p>
      </div> -->
      <paper-dialog-scrollable>
        <div class="actions-list">
          <template is="dom-repeat" items="{{elementData.docs}}" as="doc">
            
            <div class="line">
              <div class="line-container" on-tap="_docSelected">
                <div class="line-doc-id">#[[doc.id]]</div>
                <div class="line-doc-edited">{{_formatTime(doc.edited)}}</div>
                <div class="line-doc-amount">[[_formatPrice(doc.totalAmount)]]</div>
              </div>
              <div class="line-actions">
                <paper-icon-button icon="compare-arrows" drawer-toggle on-tap="_moveDoc"></paper-icon-button>
              </div>
            </div>
          </template>
        </div>
      </paper-dialog-scrollable>

      <div class="buttons">
        <paper-button raised on-tap="_newDoc"><iron-icon icon="add"></iron-icon>{{localize('BUTTON_NEW')}}</paper-button>
        <paper-button raised dialog-dismiss>{{localize('BUTTON_CLOSE')}}</paper-button>
      </div>
    </paper-dialog>

  </template>

  <script>
    class NcZoneElementSelectDocDialog extends Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior], ncZoneBehavior(Polymer.Element)) {
      static get is() {
        return 'nc-zone-element-select-doc-dialog'; 
      }

      static get properties() {
        return {
          language: String,
          elementConf: Object,
          elementData: Object
        }
      }

      connectedCallback(){
        super.connectedCallback();
        this.useKeyIfMissing = true;
        
        this.loadResources(this.resolveUrl('static/translations.json'));
      }

      open(){
        /* Fix Modal paper-dialog appears behind its backdrop */
        var app = document.querySelector('body').firstElementChild.shadowRoot;
        Polymer.dom(app).appendChild(this.$.selectDocDialog);
        this.$.selectDocDialog.open();
      }

      _newDoc(e){
        this.dispatchEvent(new CustomEvent('element-selected', {detail: {elementConf: this.elementConf}, bubbles: true, composed: true }));
        this.elementConf = {};
        this.elementData = {};
        this.$.selectDocDialog.close();
      }

      _docSelected(e){
        this.dispatchEvent(new CustomEvent('element-selected', {detail: {elementConf: this.elementConf, ticketId: e.model.doc.id}, bubbles: true, composed: true }));
        this.elementConf = {};
        this.elementData = {};
        this.$.selectDocDialog.close();
      }

      _moveDoc(e){
        this.dispatchEvent(new CustomEvent('element-selected-to-move', {detail: {elementConf: this.elementConf, ticketId: e.model.doc.id}, bubbles: true, composed: true }));
        this.elementConf = {};
        this.elementData = {};
        this.$.selectDocDialog.close();
      }

    }

    window.customElements.define(NcZoneElementSelectDocDialog.is, NcZoneElementSelectDocDialog);
  </script>
</dom-module>
